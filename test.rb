require 'rspec'
require_relative 'main'

file = STDIN.map(&:chomp) 

RSpec.describe Main do
    describe '#by_overall_visits_desc' do
        it 'returns a list of page urls and overall visits' do
            expect(Main.by_overall_visits_desc file).to eq([["/about/2", {"444.701.448.104"=>true, :unique=>22, :overall=>90, "836.973.694.403"=>true, "184.123.665.067"=>true, "382.335.626.855"=>true, "543.910.244.929"=>true, "555.576.836.194"=>true, "802.683.925.780"=>true, "200.017.277.774"=>true, "126.318.035.038"=>true, "451.106.204.921"=>true, "235.313.352.950"=>true, "217.511.476.080"=>true, "316.433.849.805"=>true, "061.945.150.735"=>true, "715.156.286.412"=>true, "646.865.545.408"=>true, "016.464.657.359"=>true, "897.280.786.156"=>true, "682.704.613.213"=>true, "722.247.931.582"=>true, "158.577.775.616"=>true, "336.284.013.698"=>true}], ["/contact", {"184.123.665.067"=>true, :unique=>23, :overall=>89, "543.910.244.929"=>true, "555.576.836.194"=>true, "200.017.277.774"=>true, "316.433.849.805"=>true, "836.973.694.403"=>true, "158.577.775.616"=>true, "016.464.657.359"=>true, "682.704.613.213"=>true, "444.701.448.104"=>true, "802.683.925.780"=>true, "382.335.626.855"=>true, "722.247.931.582"=>true, "126.318.035.038"=>true, "336.284.013.698"=>true, "451.106.204.921"=>true, "897.280.786.156"=>true, "217.511.476.080"=>true, "061.945.150.735"=>true, "646.865.545.408"=>true, "235.313.352.950"=>true, "715.156.286.412"=>true, "929.398.951.889"=>true}], ["/index", {"444.701.448.104"=>true, :unique=>23, :overall=>82, "316.433.849.805"=>true, "802.683.925.780"=>true, "929.398.951.889"=>true, "184.123.665.067"=>true, "158.577.775.616"=>true, "897.280.786.156"=>true, "555.576.836.194"=>true, "200.017.277.774"=>true, "722.247.931.582"=>true, "451.106.204.921"=>true, "217.511.476.080"=>true, "836.973.694.403"=>true, "382.335.626.855"=>true, "543.910.244.929"=>true, "126.318.035.038"=>true, "682.704.613.213"=>true, "016.464.657.359"=>true, "235.313.352.950"=>true, "061.945.150.735"=>true, "336.284.013.698"=>true, "646.865.545.408"=>true, "715.156.286.412"=>true}], ["/about", {"061.945.150.735"=>true, :unique=>21, :overall=>81, "126.318.035.038"=>true, "235.313.352.950"=>true, "836.973.694.403"=>true, "929.398.951.889"=>true, "715.156.286.412"=>true, "336.284.013.698"=>true, "722.247.931.582"=>true, "897.280.786.156"=>true, "016.464.657.359"=>true, "802.683.925.780"=>true, "543.910.244.929"=>true, "316.433.849.805"=>true, "451.106.204.921"=>true, "555.576.836.194"=>true, "158.577.775.616"=>true, "682.704.613.213"=>true, "382.335.626.855"=>true, "217.511.476.080"=>true, "184.123.665.067"=>true, "646.865.545.408"=>true}], ["/help_page/1", {"126.318.035.038"=>true, :unique=>23, :overall=>80, "929.398.951.889"=>true, "722.247.931.582"=>true, "646.865.545.408"=>true, "543.910.244.929"=>true, "836.973.694.403"=>true, "316.433.849.805"=>true, "184.123.665.067"=>true, "158.577.775.616"=>true, "682.704.613.213"=>true, "217.511.476.080"=>true, "016.464.657.359"=>true, "451.106.204.921"=>true, "897.280.786.156"=>true, "382.335.626.855"=>true, "235.313.352.950"=>true, "444.701.448.104"=>true, "802.683.925.780"=>true, "336.284.013.698"=>true, "715.156.286.412"=>true, "555.576.836.194"=>true, "061.945.150.735"=>true, "200.017.277.774"=>true}], ["/home", {"184.123.665.067"=>true, :unique=>23, :overall=>78, "235.313.352.950"=>true, "316.433.849.805"=>true, "444.701.448.104"=>true, "336.284.013.698"=>true, "382.335.626.855"=>true, "802.683.925.780"=>true, "451.106.204.921"=>true, "897.280.786.156"=>true, "715.156.286.412"=>true, "836.973.694.403"=>true, "555.576.836.194"=>true, "646.865.545.408"=>true, "217.511.476.080"=>true, "682.704.613.213"=>true, "200.017.277.774"=>true, "061.945.150.735"=>true, "543.910.244.929"=>true, "722.247.931.582"=>true, "016.464.657.359"=>true, "158.577.775.616"=>true, "929.398.951.889"=>true, "126.318.035.038"=>true}]])
        end
    end
    describe '#by_unique_visits_desc' do
        it 'returns a list of page urls and unique visits' do
            expect(Main.by_unique_visits_desc file).to eq([["/help_page/1", {"126.318.035.038"=>true, :unique=>23, :overall=>80, "929.398.951.889"=>true, "722.247.931.582"=>true, "646.865.545.408"=>true, "543.910.244.929"=>true, "836.973.694.403"=>true, "316.433.849.805"=>true, "184.123.665.067"=>true, "158.577.775.616"=>true, "682.704.613.213"=>true, "217.511.476.080"=>true, "016.464.657.359"=>true, "451.106.204.921"=>true, "897.280.786.156"=>true, "382.335.626.855"=>true, "235.313.352.950"=>true, "444.701.448.104"=>true, "802.683.925.780"=>true, "336.284.013.698"=>true, "715.156.286.412"=>true, "555.576.836.194"=>true, "061.945.150.735"=>true, "200.017.277.774"=>true}], ["/contact", {"184.123.665.067"=>true, :unique=>23, :overall=>89, "543.910.244.929"=>true, "555.576.836.194"=>true, "200.017.277.774"=>true, "316.433.849.805"=>true, "836.973.694.403"=>true, "158.577.775.616"=>true, "016.464.657.359"=>true, "682.704.613.213"=>true, "444.701.448.104"=>true, "802.683.925.780"=>true, "382.335.626.855"=>true, "722.247.931.582"=>true, "126.318.035.038"=>true, "336.284.013.698"=>true, "451.106.204.921"=>true, "897.280.786.156"=>true, "217.511.476.080"=>true, "061.945.150.735"=>true, "646.865.545.408"=>true, "235.313.352.950"=>true, "715.156.286.412"=>true, "929.398.951.889"=>true}], ["/home", {"184.123.665.067"=>true, :unique=>23, :overall=>78, "235.313.352.950"=>true, "316.433.849.805"=>true, "444.701.448.104"=>true, "336.284.013.698"=>true, "382.335.626.855"=>true, "802.683.925.780"=>true, "451.106.204.921"=>true, "897.280.786.156"=>true, "715.156.286.412"=>true, "836.973.694.403"=>true, "555.576.836.194"=>true, "646.865.545.408"=>true, "217.511.476.080"=>true, "682.704.613.213"=>true, "200.017.277.774"=>true, "061.945.150.735"=>true, "543.910.244.929"=>true, "722.247.931.582"=>true, "016.464.657.359"=>true, "158.577.775.616"=>true, "929.398.951.889"=>true, "126.318.035.038"=>true}], ["/index", {"444.701.448.104"=>true, :unique=>23, :overall=>82, "316.433.849.805"=>true, "802.683.925.780"=>true, "929.398.951.889"=>true, "184.123.665.067"=>true, "158.577.775.616"=>true, "897.280.786.156"=>true, "555.576.836.194"=>true, "200.017.277.774"=>true, "722.247.931.582"=>true, "451.106.204.921"=>true, "217.511.476.080"=>true, "836.973.694.403"=>true, "382.335.626.855"=>true, "543.910.244.929"=>true, "126.318.035.038"=>true, "682.704.613.213"=>true, "016.464.657.359"=>true, "235.313.352.950"=>true, "061.945.150.735"=>true, "336.284.013.698"=>true, "646.865.545.408"=>true, "715.156.286.412"=>true}], ["/about/2", {"444.701.448.104"=>true, :unique=>22, :overall=>90, "836.973.694.403"=>true, "184.123.665.067"=>true, "382.335.626.855"=>true, "543.910.244.929"=>true, "555.576.836.194"=>true, "802.683.925.780"=>true, "200.017.277.774"=>true, "126.318.035.038"=>true, "451.106.204.921"=>true, "235.313.352.950"=>true, "217.511.476.080"=>true, "316.433.849.805"=>true, "061.945.150.735"=>true, "715.156.286.412"=>true, "646.865.545.408"=>true, "016.464.657.359"=>true, "897.280.786.156"=>true, "682.704.613.213"=>true, "722.247.931.582"=>true, "158.577.775.616"=>true, "336.284.013.698"=>true}], ["/about", {"061.945.150.735"=>true, :unique=>21, :overall=>81, "126.318.035.038"=>true, "235.313.352.950"=>true, "836.973.694.403"=>true, "929.398.951.889"=>true, "715.156.286.412"=>true, "336.284.013.698"=>true, "722.247.931.582"=>true, "897.280.786.156"=>true, "016.464.657.359"=>true, "802.683.925.780"=>true, "543.910.244.929"=>true, "316.433.849.805"=>true, "451.106.204.921"=>true, "555.576.836.194"=>true, "158.577.775.616"=>true, "682.704.613.213"=>true, "382.335.626.855"=>true, "217.511.476.080"=>true, "184.123.665.067"=>true, "646.865.545.408"=>true}]])
        end
    end
    describe '#map_data' do
        it 'return mapped data' do
            expect(Main.map_data ["/abc 111.222.333.444"]).to eq({"/abc"=>{"111.222.333.444"=>true, :unique=>1, :overall=>1}})
        end
    end
    describe '#check_ip' do
        it 'check if ip is in correct format' do
            expect(Main.check_ip '444.701.448.104').to eq(true)
        end
    end
    describe '#check_url' do
        it 'check if url is in correct format' do
            expect(Main.check_url '/url').to eq(true)
        end
    end
    describe '#get_ip_n_url' do
        it 'extracts ip and url from string and return a hash' do
            expect(Main.get_ip_n_url '/url 444.701.448.104').to eq({url: '/url', ip: '444.701.448.104'})
        end
    end
end